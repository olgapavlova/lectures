<img width="1280" height="720" alt="2025-10-17" src="https://github.com/user-attachments/assets/334eccbc-b51f-4d66-a5cc-a24700199ee7" />

Youtube-–∑–∞–ø–∏—Å—å –æ—Ç `2025-10-17`: https://youtu.be/FrgEhxLC2cg

# –ò–∑–º–µ—Ä—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å C-–∫–æ–¥–∞

> [!TIP]
> –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è profiling (–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –î–∞–≤–∞–π—Ç–µ –ø–æ—É–º–Ω–æ–∂–∞–µ–º –º–∞—Ç—Ä–∏—Ü—ã

–≠—Å–∫–∏–∑ –∫–æ–¥–∞ (–±–µ–∑ –æ–±–≤—è–∑–∫–∏):
```c
for (int i = 0; i < height; i++) {
	for (int j = 0; j < width; j++) {
		for (int k = 0; k < width; k++) {
			result[i][j] += a[i][k] * b[k][j]
		}
	}
}
```

> [!TIP]
> –ó–Ω–∞–Ω–∏–µ vs –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
> –ú—ã –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ *–∫–∞–∫–∞—è-—Ç–æ* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –µ—Å—Ç—å. –ù–æ –∫–∞–∫ –µ—ë **—É–≤–∏–¥–µ—Ç—å**?

## –ò–∑–º–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
–§—É–Ω–∫—Ü–∏—è —É–º–Ω–æ–∂–µ–Ω–∏—è (–∫–∞–∫ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ) ‚Äî —á—ë—Ä–Ω—ã–π —è—â–∏–∫.
–ú—ã –Ω–µ –º–æ–∂–µ–º –º–µ–Ω—è—Ç—å –∫–æ–¥, –º–æ–∂–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–º.
**–ó–∞–¥–∞—á–∞ ‚Äî —É–∑–Ω–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –∏–º–µ—é—â–µ–≥–æ—Å—è —Ä–µ—à–µ–Ω–∏—è.**

> [!INFO]
> –¢–æ–ª—å–∫–æ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –∫–æ–¥
> –î–ª—è —Ñ—É–Ω–∫—Ü–∏–π —è–¥—Ä–∞ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤—â–∏–∫–∏ (—Ö–æ—Ç—è –∏ –∏—Ö –º–æ–∂–Ω–æ –ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç—å –∫ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º)

## –ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞, –∫–∞–∫ –≤–∞–ª–µ–Ω–æ–∫: –∑–∞—Å–µ–∫–∞–µ–º –≤—Ä–µ–º—è
```mermaid
flowchart LR
pre([–¥–æ]):::yellow
pre_p((‚Ä¢)):::black
start[üïê —Å—Ç–∞—Ä—Ç]:::red
code([—Ö–æ—Ç–∏–º –∏–∑–º–µ—Ä–∏—Ç—å]):::green
finish[üïí —Ñ–∏–Ω–∏—à]:::red
post_p((‚Ä¢)):::black
post([–ø–æ—Å–ª–µ]):::yellow

subgraph main
pre ==> pre_p ==> code ==> post_p ==> post
end

start -.-> pre_p
finish -.-> post_p

classDef green fill:#B8BA46;
classDef black fill:#272727,color:#FBFAF3;
classDef yellow fill:#F9B618;
classDef red fill:#FE8019,color:#FBFAF3;

```

- –î–µ–ª–∞–µ–º ¬´—à—Ç–∞–º–ø—ã –≤—Ä–µ–º–µ–Ω–∏¬ª ‚Äî timestamp
- –ü–æ—Ç–æ–º —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —Ö–æ—Ç–∏–º

### –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π timestamp

```c
#include <time.h>
...
clock_t start = clock();
function_to_measure();
clock_t finish = clock();
double time = (double)(finish - start) / CLOCKS_PER_SEC;  // —Å–µ–∫—É–Ω–¥—ã 
```

### Timestamp —Å –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–∞–º–∏
```c
#define _POSIX_C_SOURCE 199309L
...
struct timespec start, finish;
...
clock_gettime(CLOCK_MONOTONIC_RAW, &start);
function_to_measure();
clock_gettime(CLOCK_MONOTONIC_RAW, &finish);
double time = (finish.tv_sec - start.tv_sec) +
	¬†¬† ¬† ¬† ¬† ¬†(finish.tv_nsec - start.tv_nsec) / 1e9;
```
- `CLOCK_PROCESS_CPUTIME_ID` ‚Äî –∏–∑–º–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è

> [!TIP]
> –°–∞–º–æ–µ –≤—Ä–µ–º—è –ø–æ–º–µ–Ω—è—Ç—å —Ñ–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
> `-O0` –∏ `-O1` —É–∂–µ –¥–∞—é—Ç —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è ‚Äî –∞ –≤–µ–¥—å –µ—â—ë –µ—Å—Ç—å `-O2` –∏ `-O3`

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–∏

#### gprof ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ gcc

```bash
gcc -pg main.c
./a.out                # —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª gmon.out
gprof a.out gmon.out
```

- –ú–µ—Ç–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç `gcc`
- `gprof` —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç
- –î–ª—è —É—Ä–æ–≤–Ω—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ `-O3` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–∞–º –º–µ–Ω—è–µ—Ç—Å—è –≥—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤)
- ==–ú–µ–Ω—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è== (—Ç–æ—á–Ω–µ–µ, –µ–≥–æ –º–µ–Ω—è–µ—Ç —Ñ–ª–∞–≥ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ `-pg`)

#### perf ‚Äî —É–∂–µ –ø–æ–∫—Ä—É—á–µ –∏ –¥–∞–∂–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç

> [!WARNING]
> –•–æ—á–µ—Ç –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∞–≤

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —Ü–µ–ª–æ–º:
```bash
sudo perf stat ./a.out
```

–°–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç:
```bash
sudo perf record -g ./a.out  # —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª perf.data
sudo perf report
```

- –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å ‚Äî –∞–∂ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∂–µ–ª–µ–∑–∞
- –®–∏–∫–∞—Ä–Ω—ã–π –æ—Ç—á—ë—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ—Ç–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–æ —Å `-g`)
- –ù–∞–¥–æ –≤—Å–µ—Ä—å—ë–∑ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Ç–æ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–æ–º –±–µ–∑ —Å–ø–µ—Ü. –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ï—Å—Ç—å –º–Ω–æ–≥–æ –∫—É–¥–∞ –±–æ–ª–µ–µ –∑–∞—Ç–µ–π–ª–∏–≤—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### valgrind ‚Äî –≤—Å–µ–æ–±—â–∏–π –ª—é–±–∏–º–µ—Ü

```bash
valgring --tool=callgrind ./a.out  # —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª callgrind.out.[pid]
callgrind_annotate callgrind.out.[pid]
```

- –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π. –û—á–µ–Ω—å!
- –¢–æ–ª—å–∫–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –ú–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –¥–æ/–ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
callgrind_annotate callgrind.out.before callgrind.out.after
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞—Å—Å–µ–º–±–ª–µ—Ä–∞

> [!WARNING]
> –ü–æ–ª–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
> –ù—É, –º–æ–∂–µ—Ç, –∏ –Ω–µ –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –Ω–æ –æ—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥ —Ç–æ—á–Ω–æ

> [!INFO]
> –°–º–æ—Ç—Ä–∏–º –¥–ª—è ARMv8 (–¥—Ä—É–≥–æ–≥–æ —É –º–µ–Ω—è –∏ –Ω–µ—Ç)
> –ö–æ–¥ –¥–ª—è RISC-V –∑–∞–º–µ—Ç–Ω–æ –ø—Ä–æ—â–µ. –ö–æ–¥ –¥–ª—è x86 –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π –∂–µ.

```c
#include <stdio.h>
#include <stdint.h>
...
static inline uint64_t read_cntvct(void) {
¬† ¬† uint64_t val;
¬† ¬† __asm__ volatile("mrs %0, cntvct_el0" : "=r" (val));
¬† ¬† return val;
}

static inline uint64_t read_cntfrq(void) {
¬† ¬† uint64_t val;
¬† ¬† __asm__ volatile("mrs %0, cntfrq_el0" : "=r" (val));
¬† ¬† return val;
}
...
uint64_t freq = read_cntfrq();
...
uint64_t start = read_cntvct();
function_to_measure();
uint64_t finish = read_cntvct();
double time = (double) (finish - start) / freq);
```

- `static` —É–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ª–∏–Ω–∫–æ–≤–∫–∏ (–Ω–µ—Ç –ª–∏–Ω–∫–æ–≤–∫–∏ ‚Äî –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- `inline` –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (–∞ —ç—Ç–æ –Ω–∞–≥—Ä—É–∑–∫–∞)
- `volatile` –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

## –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π

### –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –æ–¥–Ω–æ–º—É —è–¥—Ä—É

```bash
taskset -c 0 [–∫–æ–º–∞–Ω–¥–∞]
```

- `nproc` ‚Äî —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —è–¥–µ—Ä
- `lscpu` ‚Äî –±–æ–ª—å—à–µ –≤—Å—è–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä

### –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã

–°–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã:
```bash
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
```

–ü–æ—Ç–æ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ:
```bash
sudo cpupower frequency-set -g performance
```

–ò –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å—ë –≤—Å—Ç–∞–ª–æ —É–¥–∞—á–Ω–æ:
```bash
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
```

–ß—Ç–æ–±—ã –ø–æ–∫–æ–ø–∞—Ç—å—Å—è –≤ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º:
```bash
sudo cpupower frequency-info
```

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –≤ ¬´–æ–±—ã—á–Ω—ã–π¬ª —Ä–µ–∂–∏–º:
```bash
sudo cpupower frequency-set -g schedutil
```

### –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- –¢—É—Ç –≤—Å—ë –æ—á–µ–≤–∏–¥–Ω–æ ‚Äî N –∑–∞–ø—É—Å–∫–æ–≤ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ
- –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å N –≤—Ö–æ–¥—è—â–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º

### –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞

> [!WARNING]
> –ë–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ö–æ–∂–µ –Ω–∞ –º–∞–≥–∏—é
> –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –ø–æ–≤–æ–¥ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è

- **–°—É—Ç—å ‚Äî ¬´–Ω–∞—É—á–∏—Ç—å¬ª —Å–∏—Å—Ç–µ–º—É –∫–æ–¥—É**
- –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–≥–Ω–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Ö–æ–ª–æ—Å—Ç—É—é
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ–±—ä—ë–º—ã –∫—ç—à–∞ + –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–æ–Ω—è—Ç—å –±–µ–∑ –Ω–µ–≥–æ

## 2025-10-17 ‚Üí 2025-10-24
### –ß—Ç–æ –º–æ–∂–Ω–æ –µ—â—ë?
- –∑–∞–º–µ—Ä—ã –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö;
- —Ä–∞–∑–Ω—ã–µ –æ–ø—Ü–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞;
- —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ñ–º–∞–º–∏ —É–º–Ω–æ–∂–µ–Ω–∏—è –º–∞—Ç—Ä–∏—Ü;
- –ø–æ–∏—Å–∫ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã—Ö ¬´—Ç–æ—á–µ–∫ –ø–µ—Ä–µ—Ö–æ–¥–∞¬ª –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –º–∞—Ç—Ä–∏—Ü;
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –æ–¥–∏–Ω ¬´—é–Ω–∏—Ç¬ª (–µ–¥–∏–Ω–∏—Ü—É).

> [!TIP]
> –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚Äî –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑



