
<img width="1280" height="720" alt="2025-08-01" src="https://github.com/user-attachments/assets/8518856f-5bf8-4a92-9fb5-94763c56e515" />

# –ö—Ä–æ—Ö–æ—Ç–Ω—ã–π –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç –Ω–∞ ATtiny13A –∏ C

Youtube-–∑–∞–ø–∏—Å—å –æ—Ç `2025-08-01`: https://youtu.be/EJmQKRU_cpw

## –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ—Ä–∞ –ø–∏—Ç—å

- [x]  –ü—Ä–æ—Å—Ç–æ —Ç–∞–π–º–µ—Ä
- [ ]  –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
- [ ]  –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ—Å–∞ —á–µ–ª–æ–≤–µ–∫–∞
- [ ]  –°–∏–º–ø–∞—Ç–∏—á–Ω—ã–µ —Å–≤–µ—Ç–æ—ç—Ñ—Ñ–µ–∫—Ç—ã
- [ ]  –ó–≤—É–∫
- [ ]  –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
- [ ]  SMD-–≤–∞—Ä–∏–∞–Ω—Ç
- [ ]  –ì–∏—Ä–æ—Å–∫–æ–ø –Ω–∞ –∫—Ä—É–∂–∫—É
- [ ]  ‚Ä¶

![IMG_9108.jpeg](attachment:476d972e-514c-4cc8-a5b5-c69254d964c5:IMG_9108.jpeg)

## –°–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–≤—è–∑—å –º–µ–∂–¥—É –Ω–∏–º–∏

```mermaid
flowchart TB
start(–ù–∞—á–∏–Ω–∞–µ–º)
waiting(–ñ–¥—ë–º)
check(–ü—Ä–æ–≤–µ—Ä—è–µ–º)
alarm(–ü–æ—Ä–∞ –ø–∏—Ç—å)
drop(–ó–∞–Ω–æ–≤–æ)

start:::black ==> waiting:::green
waiting ==> check:::black
check ==> waiting
check --> alarm:::red
alarm --> drop:::yellow
drop --> waiting

classDef red fill:#FE8019;
classDef green fill:#B8BA46;
classDef yellow fill:#FABD2F;
classDef black fill:#504945,color:#fff;
```

<aside>
<img src="/icons/log-out_blue.svg" alt="/icons/log-out_blue.svg" width="40px" />

**–ò—â–µ–º —Ç–æ–ª—å–∫–æ –≤—ã—Ö–æ–¥—ã**
–ü–æ—Ç–æ–º—É —á—Ç–æ –≤—Å—è–∫–∏–π –≤—Ö–æ–¥ ‚Äî —ç—Ç–æ –≤—ã—Ö–æ–¥ –æ—Ç–∫—É–¥–∞-—Ç–æ.

</aside>

<aside>
<img src="/icons/condense_green.svg" alt="/icons/condense_green.svg" width="40px" />

**–í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ ‚Äî —Å–≤–æ–∏ –¥–µ–ª–∞**
–ß—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ –∏–≥—Ä—ã –ø–æ —Å—Ç–∞–Ω—Ü–∏—è–º, –∏–ª–∏ –∫–∞—Ä—Ç—ã —Å –∫–≤–µ—Å—Ç–∞–º–∏, –∏–ª–∏ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–∫–æ–≤/–ø–∞—Ä/–æ–±—ä–µ–∫—Ç–æ–≤

</aside>

<aside>
<img src="/icons/apron_yellow.svg" alt="/icons/apron_yellow.svg" width="40px" />

**–î–µ–ª–∞-—Ç–æ —Ä–∞–∑–Ω—ã–µ!**
–î–µ–ª–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏. –≠—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –µ—Å—Ç—å ¬´—Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª.

</aside>

## –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

> –°–ø–æ—Å–æ–± ~~—Ä–∞–∑–ª–æ–∂–∏—Ç—å –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º~~ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.
> 

```mermaid
flowchart TB
do(–î–µ–ª–∞–µ–º)
check(–û–±–Ω–æ–≤–ª—è–µ–º—Å—è)
do:::green <==> check:::black

classDef green fill:#B8BA46;
classDef black fill:#504945,color:#fff;
```

<aside>
<img src="/icons/sync-reverse_purple.svg" alt="/icons/sync-reverse_purple.svg" width="40px" />

**–¢—É–¥–∞-—Å—é–¥–∞ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏**
–ö–∞–∫ –∑–∞–∫–æ–Ω—á–∏–ª–∏ –¥–µ–ª–∞—Ç—å ‚Äî —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º. –ö–∞–∫ –∑–∞–∫–æ–Ω—á–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å ‚Äî —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ–º.

</aside>

<aside>
<img src="/icons/archery_orange.svg" alt="/icons/archery_orange.svg" width="40px" />

**–í–ø–µ—Ä–≤—ã–µ –∏–ª–∏ —Å–Ω–æ–≤–∞?**
–ú—ã –Ω–µ –∑–Ω–∞–µ–º, –∫–æ–≥–¥–∞ –¥–µ–ª–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑. –ù–æ –∑–Ω–∞–µ–º, –∫–æ–≥–¥–∞ –≤ –ø–µ—Ä–≤—ã–π (–∏–ª–∏ –¥–∞–∂–µ –≤ N-–π).

</aside>

<aside>
<img src="/icons/alarm_lightgray.svg" alt="/icons/alarm_lightgray.svg" width="40px" />

**–û–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ –¥–µ–ª–∞?!**
–î–∞. –ù–µ —É—Å–ª–æ–∂–Ω—è–µ–º –ø–æ–∫–∞ —á—Ç–æ.

</aside>

```c
int main(void) {
	while(1) {
		state_do();
		state_update();
	}
	return 0;
}
```

- –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω
- –ö–∞–∫ `state_do();` —É–∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç–∞–º –Ω–∞–∏–∑–º–µ–Ω—è–ª `state_update();`?
- –ò –∫–∞–∫ `state_update();` –∏–∑–º–µ–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ –∫–æ—Ç–æ—Ä–æ–º –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å `state_do();`?

> –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?! üòë
–ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ.
> 

## –ñ–µ–ª–∞–Ω–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

```mermaid
flowchart LR
subgraph –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
light(–°–≤–µ—Ç–æ–¥–∏–æ–¥):::green
temp(–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞):::yellow
time(–í—Ä–µ–º—è):::green
drop(–ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞):::green
end

subgraph –ü–∞—Ç—Ç–µ—Ä–Ω—ã
shim(–®–ò–ú):::black
wire(–ü—Ä–æ—Ç–æ–∫–æ–ª):::black
ii(–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ):::green
end

subgraph –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
timer(–¢–∞–π–º–µ—Ä):::red
dpin(–¶–∏—Ñ—Ä–æ–≤—ã–µ –≤—Ö-–≤—ã—Ö):::green
apin(–ê–Ω–∞–ª–æ–≥–æ–≤—ã–µ –≤—Ö–æ–¥—ã):::black
end

light -.-> |–º–µ—Ä—Ü–∞–Ω–∏–µ| timer

light -.-> |—è—Ä–∫–æ—Å—Ç—å| shim
shim -.-> timer

temp -.-> |—Ü–∏—Ñ—Ä–æ–≤–æ–π| wire
wire -.-> timer

temp -.-> |–∞–Ω–∞–ª–æ–≥–æ–≤—ã–π| ii
ii -.-> apin

drop -.-> ii
ii -.-> dpin

time -.-> ii

classDef red fill:#FE8019;
classDef green fill:#B8BA46;
classDef yellow fill:#FABD2F;
classDef black fill:#504945,color:#fff;
```

<aside>
<img src="/icons/alarm_red.svg" alt="/icons/alarm_red.svg" width="40px" />

–¢–∞–π–º–µ—Ä ‚Äî —É–∑–∫–æ–µ –º–µ—Å—Ç–æ

</aside>

<aside>
<img src="/icons/hammer_gray.svg" alt="/icons/hammer_gray.svg" width="40px" />

–ì—Ä—É–±–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

</aside>

<aside>
<img src="/icons/wifi_pink.svg" alt="/icons/wifi_pink.svg" width="40px" />

–ü—Ä–æ—Ç–æ–∫–æ–ª –∫–∞–ø—Ä–∏–∑–µ–Ω –∫–æ –≤—Ä–µ–º–µ–Ω–∏

</aside>

## –ö–æ–¥ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö

### –ë–∞–∑–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```c
#include <avr/io.h>
#include <avr/interrupt.h>
```

### –ü–∏–Ω—ã

```c
#define LED_PIN PB4
#define BUTTON_PIN PB3
```

```c
    DDRB  |= (1 << LED_PIN);      // –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å LED_PIN –∫–∞–∫ –≤—ã—Ö–æ–¥
    DDRB  &= ~(1 << BUTTON_PIN);  // –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å BUTTON_PIN –∫–∞–∫ –≤—Ö–æ–¥
    PORTB &= ~(1 << BUTTON_PIN);  // –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –ø–æ–¥—Ç—è–∂–∫—É (–µ—Å—Ç—å –≤–Ω–µ—à–Ω—è—è)
```

### –ò–Ω–∏—Ü–∏–∞—Ü–∏—è —Å—á—ë—Ç—á–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

```c
int main(void) {
	...
	timer_init();
  sei();
  while(1) {
	  ...
  }
}
```

```c
void timer_init() {
    TCCR0A = 0;                          // normal mode
    TCCR0B |= (1 << CS02) | (1 << CS00); // –¥–µ–ª–∏—Ç–µ–ª—å /1024
    TIMSK0 |= (1 << TOIE0);              // —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é
    TCNT0 = 0;                           // —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
}
```

### –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é —Å—á—ë—Ç—á–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

```c
ISR(TIM0_OVF_vect) {
    ticks_g++;                             // volatile!
    check_g = ticks_g % CHECK_EVERY_TICK;  // —Ñ–æ–∫—É—Å —Å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é
    if (ticks_g >= TICKS_IN_TIME_UNIT) {   // —Å—á–∏—Ç–∞–µ–º –≤ —é–Ω–∏—Ç–∞—Ö
        ticks_g = 0;
        units_g++;
    }
}
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å volatile-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

```c
void func() {
    cli(); // –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
		...
    sei(); // –≤–∫–ª—é—á–∏–º –æ–±—Ä–∞—Ç–Ω–æ
}
```

### –ù–∞–∂–∞—Ç–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞

```c
((PINB & (1 << BUTTON_PIN)) == 0)
```

### –í–∫–ª/–≤—ã–∫–ª/–ø–µ—Ä–µ–∫–ª —Å–≤–µ—Ç–æ–¥–∏–æ–¥

```c
PORTB |= (1 << LED_PIN);
PORTB &= ~(1 << LED_PIN);
PORTB ^= (1 << LED_PIN);
```
